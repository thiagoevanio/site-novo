<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0ea5e9">
    <title>Desafio da Rotina Saud√°vel - Calcule Sua Sa√∫de</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Simule um dia perfeito! Tome as melhores decis√µes desde a hora de acordar at√© a hora de dormir neste jogo interativo.">
    <link rel="canonical" href="https://calculesuasaude.com.br/jogos/rotina_saudavel.html">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a',
                        },
                        morning: '#f59e0b', // Amber
                        afternoon: '#0ea5e9', // Sky
                        night: '#6366f1', // Indigo
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-panel {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .option-card.selected-correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }
        .option-card.selected-wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        /* Dark mode overrides applied via JS logic classes */
    </style>
</head>
<body class="bg-blue-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Header Simples -->
    <header class="fixed w-full top-0 z-50 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-b border-blue-100 dark:border-gray-800 shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="../index.html" class="flex items-center gap-2 group">
                <div class="bg-blue-500 text-white p-2 rounded-lg group-hover:rotate-3 transition-transform">
                    <i data-lucide="sun" class="w-5 h-5"></i>
                </div>
                <h1 class="text-lg font-bold text-gray-900 dark:text-white tracking-tight">
                    Calcule Sua <span class="text-blue-500">Sa√∫de</span>
                </h1>
            </a>
            <a href="../jogos.html" class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-blue-500 transition-colors flex items-center gap-1">
                <i data-lucide="gamepad-2" class="w-4 h-4"></i> Voltar
            </a>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex-1 pt-24 pb-12 flex items-center justify-center px-4 relative overflow-hidden">
        
        <!-- Elementos de Fundo (Mudam com o tempo do jogo) -->
        <div id="bg-decoration" class="absolute top-0 left-0 w-full h-full transition-colors duration-1000 z-0 bg-gradient-to-b from-blue-100 to-white dark:from-gray-800 dark:to-gray-900"></div>
        <div class="absolute -top-20 -right-20 w-96 h-96 bg-yellow-300/30 rounded-full blur-3xl pointer-events-none"></div>
        <div class="absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-white to-transparent dark:from-gray-900 opacity-50 pointer-events-none"></div>

        <div class="w-full max-w-3xl relative z-10">

            <!-- TELA INICIAL -->
            <div id="start-screen" class="glass-panel rounded-3xl p-8 md:p-16 shadow-2xl text-center animate-slide-up">
                <div class="inline-block p-4 bg-blue-100 dark:bg-blue-900/30 rounded-full mb-6 text-blue-600 dark:text-blue-400">
                    <i data-lucide="calendar-clock" class="w-12 h-12"></i>
                </div>
                <h1 class="text-4xl md:text-5xl font-black text-gray-900 dark:text-white mb-6">Jornada Saud√°vel</h1>
                <p class="text-xl text-gray-600 dark:text-gray-300 mb-8 leading-relaxed max-w-xl mx-auto">
                    Voc√™ consegue sobreviver a um dia moderno mantendo h√°bitos saud√°veis? Tome as decis√µes certas desde o acordar at√© a hora de dormir.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10 text-left">
                    <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl border border-gray-100 dark:border-gray-700">
                        <span class="text-2xl mb-2 block">üåÖ</span>
                        <h3 class="font-bold">Manh√£</h3>
                        <p class="text-xs text-gray-500">Energia e Ativa√ß√£o</p>
                    </div>
                    <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl border border-gray-100 dark:border-gray-700">
                        <span class="text-2xl mb-2 block">‚òÄÔ∏è</span>
                        <h3 class="font-bold">Tarde</h3>
                        <p class="text-xs text-gray-500">Foco e Nutri√ß√£o</p>
                    </div>
                    <div class="bg-white/50 dark:bg-gray-800/50 p-4 rounded-xl border border-gray-100 dark:border-gray-700">
                        <span class="text-2xl mb-2 block">üåô</span>
                        <h3 class="font-bold">Noite</h3>
                        <p class="text-xs text-gray-500">Recupera√ß√£o e Sono</p>
                    </div>
                </div>

                <button onclick="game.start()" class="w-full md:w-auto px-10 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg rounded-full shadow-lg hover:shadow-blue-500/30 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2 mx-auto">
                    Iniciar Meu Dia <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- TELA DO JOGO -->
            <div id="game-screen" class="hidden flex flex-col h-full">
                
                <!-- HUD -->
                <div class="flex justify-between items-end mb-6 px-2">
                    <div>
                        <span class="text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-widest" id="phase-label">Manh√£</span>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white leading-none mt-1">Pergunta <span id="current-q">1</span><span class="text-gray-400 text-lg">/10</span></h2>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Pontos</span>
                        <div class="text-3xl font-black text-blue-600 dark:text-blue-400" id="score">0</div>
                    </div>
                </div>

                <!-- Barra de Progresso -->
                <div class="w-full bg-gray-200 dark:bg-gray-700 h-2 rounded-full mb-8 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>

                <!-- Cart√£o da Pergunta -->
                <div class="glass-panel rounded-3xl p-6 md:p-10 shadow-xl relative animate-slide-up">
                    
                    <!-- Pergunta -->
                    <div class="mb-8">
                        <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/30 text-2xl mb-4" id="q-icon">
                            ‚è∞
                        </div>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-white" id="q-text">
                            O despertador tocou! Qual a primeira coisa a fazer?
                        </h3>
                    </div>

                    <!-- Op√ß√µes -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="options-container">
                        <!-- Bot√µes gerados via JS -->
                    </div>

                    <!-- Feedback Area (Aparece ap√≥s resposta) -->
                    <div id="feedback-area" class="hidden mt-6 p-5 rounded-2xl bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 animate-fade-in">
                        <div class="flex items-start gap-3">
                            <div id="fb-icon" class="mt-1"></div>
                            <div>
                                <h4 class="font-bold text-lg mb-1" id="fb-title"></h4>
                                <p class="text-sm text-gray-600 dark:text-gray-300 leading-relaxed" id="fb-text"></p>
                            </div>
                        </div>
                        <button onclick="game.nextQuestion()" class="mt-4 w-full py-3 bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-bold rounded-xl hover:opacity-90 transition-opacity">
                            Continuar Jornada
                        </button>
                    </div>

                </div>
            </div>

            <!-- TELA DE RESULTADO -->
            <div id="result-screen" class="hidden glass-panel rounded-3xl p-8 md:p-12 shadow-2xl text-center animate-slide-up">
                <div class="relative inline-block mb-6">
                    <div class="w-24 h-24 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg">
                        <i data-lucide="award" class="w-12 h-12 text-white"></i>
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-white dark:bg-gray-800 text-xs font-bold px-3 py-1 rounded-full shadow border border-gray-100 dark:border-gray-700" id="final-badge">
                        Guru da Sa√∫de
                    </div>
                </div>
                
                <h2 class="text-3xl font-black text-gray-900 dark:text-white mb-2">Dia Conclu√≠do!</h2>
                <p class="text-gray-500 dark:text-gray-400 mb-8" id="result-msg">Voc√™ fez escolhas incr√≠veis hoje.</p>

                <div class="grid grid-cols-3 gap-4 mb-8">
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl">
                        <span class="block text-[10px] uppercase font-bold text-gray-400">Pontua√ß√£o</span>
                        <span class="block text-2xl font-black text-blue-600" id="final-score">0</span>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl">
                        <span class="block text-[10px] uppercase font-bold text-gray-400">Precis√£o</span>
                        <span class="block text-2xl font-black text-green-600" id="final-accuracy">0%</span>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl">
                        <span class="block text-[10px] uppercase font-bold text-gray-400">Sequ√™ncia</span>
                        <span class="block text-2xl font-black text-purple-600" id="final-streak">0</span>
                    </div>
                </div>

                <div class="flex flex-col gap-3 max-w-sm mx-auto">
                    <button onclick="game.reset()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i> Tentar Novo Dia
                    </button>
                    <button onclick="game.share()" class="w-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-white font-bold py-3.5 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-600 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="share-2" class="w-5 h-5"></i> Compartilhar
                    </button>
                </div>
            </div>

        </div>
    </main>

    <script>
        lucide.createIcons();

        // Banco de Dados de Perguntas (Jornada)
        const journeyData = [
            // MANH√É (1-3)
            {
                phase: "Manh√£ üåÖ",
                theme: "morning",
                icon: "‚è∞",
                question: "O despertador tocou! Qual a primeira coisa a fazer para ativar o corpo?",
                options: [
                    { text: "Ver redes sociais na cama", icon: "üì±", correct: false, feedback: "A luz azul e a dopamina logo cedo podem aumentar a ansiedade." },
                    { text: "Beber um copo d'√°gua", icon: "üíß", correct: true, feedback: "Perfeito! Seu corpo desidrata durante a noite. √Ågua ativa o metabolismo." },
                    { text: "Tomar caf√© preto forte", icon: "‚òï", correct: false, feedback: "Caf√© em jejum pode aumentar a acidez estomacal e o cortisol rapidamente." },
                    { text: "Pular da cama correndo", icon: "üèÉ", correct: false, feedback: "Calma! Mudan√ßas bruscas podem causar tontura. Espreguice-se primeiro." }
                ]
            },
            {
                phase: "Manh√£ üåÖ",
                theme: "morning",
                icon: "üç≥",
                question: "Hora do caf√© da manh√£. Qual a op√ß√£o mais equilibrada?",
                options: [
                    { text: "P√£o, ovos e fruta", icon: "ü•ë", correct: true, feedback: "Excelente! Carboidrato, prote√≠na e fibras garantem saciedade e energia." },
                    { text: "Apenas caf√©", icon: "‚òï", correct: false, feedback: "Pular refei√ß√µes pode causar queda de energia e fome excessiva depois." },
                    { text: "Cereal a√ßucarado e leite", icon: "ü•£", correct: false, feedback: "Muito a√ß√∫car causa um pico de insulina seguido de cansa√ßo r√°pido." },
                    { text: "Suco de laranja e torrada", icon: "üçä", correct: false, feedback: "Faltou prote√≠na! Isso vai te deixar com fome em menos de 1 hora." }
                ]
            },
            {
                phase: "Manh√£ üåÖ",
                theme: "morning",
                icon: "üöó",
                question: "Como ir para o trabalho/estudo de forma mais saud√°vel?",
                options: [
                    { text: "Ir de carro/√¥nibus sentado", icon: "üí∫", correct: false, feedback: "Sedentarismo total. Tente adicionar algum movimento." },
                    { text: "Descer um ponto antes e caminhar", icon: "üö∂", correct: true, feedback: "√ìtima estrat√©gia! Adiciona atividade f√≠sica sem mudar muito a rotina." },
                    { text: "Ir estressado no tr√¢nsito", icon: "ü§¨", correct: false, feedback: "O estresse matinal eleva o cortisol e prejudica o dia todo." },
                    { text: "Comendo no caminho", icon: "ü•ê", correct: false, feedback: "Comer distra√≠do e com pressa prejudica a digest√£o e a saciedade." }
                ]
            },
            // TARDE (4-7)
            {
                phase: "Tarde ‚òÄÔ∏è",
                theme: "afternoon",
                icon: "üçΩÔ∏è",
                question: "Almo√ßo no self-service. Como montar o prato?",
                options: [
                    { text: "S√≥ carnes e salada", icon: "ü•©", correct: false, feedback: "Falta energia (carboidratos). O equil√≠brio √© a chave." },
                    { text: "Metade salada, 1/4 prote√≠na, 1/4 carbo", icon: "ü•ó", correct: true, feedback: "A regra de ouro! Garante nutrientes, saciedade e controle cal√≥rico." },
                    { text: "Massa, arroz e batata", icon: "üçù", correct: false, feedback: "Excesso de carboidratos causa sonol√™ncia √† tarde." },
                    { text: "S√≥ o que eu gosto", icon: "üçî", correct: false, feedback: "O prazer √© importante, mas seu corpo precisa de nutrientes variados." }
                ]
            },
            {
                phase: "Tarde ‚òÄÔ∏è",
                theme: "afternoon",
                icon: "üò´",
                question: "Bateu aquele sono √†s 15h. O que fazer?",
                options: [
                    { text: "Tomar um energ√©tico", icon: "‚ö°", correct: false, feedback: "Muito a√ß√∫car e cafe√≠na. Vai atrapalhar seu sono √† noite." },
                    { text: "Comer um doce", icon: "üç´", correct: false, feedback: "O pico de a√ß√∫car d√° energia r√°pida, mas depois vem o cansa√ßo dobrado." },
                    { text: "Fazer uma pausa ativa e beber √°gua", icon: "üßò", correct: true, feedback: "Movimento e hidrata√ß√£o oxigenam o c√©rebro e devolvem o foco." },
                    { text: "Continuar for√ßando", icon: "üíª", correct: false, feedback: "A produtividade cai. Respeite os sinais do seu corpo." }
                ]
            },
            {
                phase: "Tarde ‚òÄÔ∏è",
                theme: "afternoon",
                icon: "üçé",
                question: "Fome no meio da tarde. Qual o melhor lanche?",
                options: [
                    { text: "Pacote de biscoito", icon: "üç™", correct: false, feedback: "Calorias vazias, gordura trans e pouco nutritivo." },
                    { text: "Iogurte com fruta ou castanhas", icon: "ü•ú", correct: true, feedback: "Combina√ß√£o perfeita de fibras, prote√≠nas e gorduras boas." },
                    { text: "N√£o comer nada at√© o jantar", icon: "ü§ê", correct: false, feedback: "Ficar muito tempo sem comer pode gerar compuls√£o √† noite." },
                    { text: "Salgado da lanchonete", icon: "ü•ü", correct: false, feedback: "Geralmente fritos e com farinha branca refinada." }
                ]
            },
            {
                phase: "Tarde ‚òÄÔ∏è",
                theme: "afternoon",
                icon: "üíß",
                question: "Voc√™ percebeu que n√£o bebeu √°gua a tarde toda.",
                options: [
                    { text: "Beber 1 litro de uma vez", icon: "üåä", correct: false, feedback: "Seu corpo n√£o absorve tudo de uma vez. Beba aos poucos." },
                    { text: "Deixar para amanh√£", icon: "üåµ", correct: false, feedback: "A desidrata√ß√£o causa dor de cabe√ßa e fadiga." },
                    { text: "Encher a garrafa e beber goles constantes", icon: "bottle", correct: true, feedback: "A hidrata√ß√£o constante √© a mais eficiente para o corpo." },
                    { text: "Tomar refrigerante para hidratar", icon: "ü•§", correct: false, feedback: "Refrigerante n√£o hidrata e adiciona a√ß√∫car desnecess√°rio." }
                ]
            },
            // NOITE (8-10)
            {
                phase: "Noite üåô",
                theme: "night",
                icon: "üç≤",
                question: "Hora do jantar. O que √© melhor para o sono?",
                options: [
                    { text: "Pizza ou lanche pesado", icon: "üçï", correct: false, feedback: "Digest√£o pesada atrapalha o sono profundo." },
                    { text: "N√£o jantar", icon: "üö´", correct: false, feedback: "Dormir com fome pode fazer voc√™ acordar de madrugada." },
                    { text: "Sopa ou prato leve com prote√≠na", icon: "ü•£", correct: true, feedback: "Nutre sem pesar, facilitando o descanso do corpo." },
                    { text: "Caf√© com p√£o", icon: "‚òï", correct: false, feedback: "Cafe√≠na √† noite? M√° ideia para quem quer dormir bem." }
                ]
            },
            {
                phase: "Noite üåô",
                theme: "night",
                icon: "üì±",
                question: "Faltam 30 minutos para dormir. O que voc√™ faz?",
                options: [
                    { text: "Rola o feed do Instagram", icon: "üì±", correct: false, feedback: "A luz azul bloqueia a melatonina, horm√¥nio do sono." },
                    { text: "V√™ not√≠cias ou filmes de a√ß√£o", icon: "üì∫", correct: false, feedback: "Est√≠mulos agitados deixam o c√©rebro alerta." },
                    { text: "L√™ um livro ou medita", icon: "üìñ", correct: true, feedback: "Atividades relaxantes preparam o c√©rebro para desligar." },
                    { text: "Discute problemas de trabalho", icon: "üì¢", correct: false, feedback: "Aumenta o estresse e a ansiedade na hora errada." }
                ]
            },
            {
                phase: "Noite üåô",
                theme: "night",
                icon: "üõèÔ∏è",
                question: "Hora de dormir. Qual o ambiente ideal?",
                options: [
                    { text: "TV ligada e luz acesa", icon: "üí°", correct: false, feedback: "Luz inibe o sono profundo e reparador." },
                    { text: "Quarto quente e abafado", icon: "üå°Ô∏è", correct: false, feedback: "O corpo precisa baixar a temperatura para dormir bem." },
                    { text: "Escuro, silencioso e fresco", icon: "zk", correct: true, feedback: "O cen√°rio perfeito para a regenera√ß√£o celular e mental!" },
                    { text: "Dormir no sof√°", icon: "üõãÔ∏è", correct: false, feedback: "Prejudica a postura e a continuidade do sono." }
                ]
            }
        ];

        class RoutineGame {
            constructor() {
                this.state = {
                    currentIndex: 0,
                    score: 0,
                    streak: 0,
                    correctCount: 0,
                    isPlaying: false
                };

                this.dom = {
                    startScreen: document.getElementById('start-screen'),
                    gameScreen: document.getElementById('game-screen'),
                    resultScreen: document.getElementById('result-screen'),
                    phaseLabel: document.getElementById('phase-label'),
                    currentQ: document.getElementById('current-q'),
                    score: document.getElementById('score'),
                    progressBar: document.getElementById('progress-bar'),
                    qIcon: document.getElementById('q-icon'),
                    qText: document.getElementById('q-text'),
                    optionsContainer: document.getElementById('options-container'),
                    feedbackArea: document.getElementById('feedback-area'),
                    fbIcon: document.getElementById('fb-icon'),
                    fbTitle: document.getElementById('fb-title'),
                    fbText: document.getElementById('fb-text'),
                    finalScore: document.getElementById('final-score'),
                    finalAccuracy: document.getElementById('final-accuracy'),
                    finalStreak: document.getElementById('final-streak'),
                    resultMsg: document.getElementById('result-msg'),
                    finalBadge: document.getElementById('final-badge'),
                    bgDecoration: document.getElementById('bg-decoration')
                };
            }

            start() {
                this.state.currentIndex = 0;
                this.state.score = 0;
                this.state.streak = 0;
                this.state.correctCount = 0;
                this.state.isPlaying = true;

                this.dom.startScreen.classList.add('hidden');
                this.dom.resultScreen.classList.add('hidden');
                this.dom.gameScreen.classList.remove('hidden');

                this.renderQuestion();
            }

            renderQuestion() {
                const question = journeyData[this.state.currentIndex];
                
                // Update UI based on phase
                this.dom.phaseLabel.textContent = question.phase;
                this.updateTheme(question.theme);
                
                this.dom.currentQ.textContent = this.state.currentIndex + 1;
                this.dom.score.textContent = this.state.score;
                this.dom.qIcon.textContent = question.icon;
                this.dom.qText.textContent = question.question;
                
                // Progress Bar
                const progress = ((this.state.currentIndex) / journeyData.length) * 100;
                this.dom.progressBar.style.width = `${progress}%`;

                // Render Options
                this.dom.optionsContainer.innerHTML = '';
                this.dom.feedbackArea.classList.add('hidden');
                
                // Shuffle options for variety
                const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-card w-full text-left p-4 rounded-xl border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 transition-all duration-200 flex items-center gap-4 group';
                    btn.innerHTML = `
                        <span class="text-3xl bg-gray-50 dark:bg-gray-700 w-12 h-12 flex items-center justify-center rounded-lg group-hover:scale-110 transition-transform">${opt.icon}</span>
                        <span class="font-semibold text-gray-700 dark:text-gray-200 text-lg">${opt.text}</span>
                    `;
                    btn.onclick = () => this.handleAnswer(opt, btn);
                    this.dom.optionsContainer.appendChild(btn);
                });
            }

            updateTheme(theme) {
                const bg = this.dom.bgDecoration;
                if (theme === 'morning') {
                    bg.className = 'absolute top-0 left-0 w-full h-full transition-colors duration-1000 z-0 bg-gradient-to-b from-orange-50 to-blue-50 dark:from-gray-800 dark:to-gray-900';
                    this.dom.phaseLabel.className = 'text-xs font-bold text-orange-500 uppercase tracking-widest';
                } else if (theme === 'afternoon') {
                    bg.className = 'absolute top-0 left-0 w-full h-full transition-colors duration-1000 z-0 bg-gradient-to-b from-blue-100 to-white dark:from-gray-800 dark:to-gray-900';
                    this.dom.phaseLabel.className = 'text-xs font-bold text-blue-500 uppercase tracking-widest';
                } else {
                    bg.className = 'absolute top-0 left-0 w-full h-full transition-colors duration-1000 z-0 bg-gradient-to-b from-indigo-100 to-purple-50 dark:from-gray-900 dark:to-gray-800';
                    this.dom.phaseLabel.className = 'text-xs font-bold text-indigo-500 uppercase tracking-widest';
                }
            }

            handleAnswer(option, btnElement) {
                // Disable all buttons
                const buttons = this.dom.optionsContainer.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                });
                btnElement.classList.remove('opacity-50');

                if (option.correct) {
                    btnElement.classList.add('selected-correct');
                    this.state.streak++;
                    this.state.correctCount++;
                    // Base points + streak bonus
                    this.state.score += 100 + (this.state.streak * 10);
                    
                    this.showFeedback(true, option.feedback);
                    
                    // Confetti
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { y: 0.7 }
                    });
                } else {
                    btnElement.classList.add('selected-wrong');
                    this.state.streak = 0;
                    this.showFeedback(false, option.feedback);
                    
                    // Highlight the correct one
                    // (Optional logic to find and show correct one)
                }
                
                this.dom.score.textContent = this.state.score;
            }

            showFeedback(isCorrect, text) {
                const area = this.dom.feedbackArea;
                const icon = this.dom.fbIcon;
                const title = this.dom.fbTitle;
                const body = this.dom.fbText;

                area.classList.remove('hidden');
                
                if (isCorrect) {
                    area.className = 'mt-6 p-5 rounded-2xl bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 animate-fade-in';
                    icon.innerHTML = '<div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600"><i data-lucide="check" class="w-5 h-5"></i></div>';
                    title.textContent = "Excelente escolha!";
                    title.className = "font-bold text-lg mb-1 text-green-700 dark:text-green-400";
                } else {
                    area.className = 'mt-6 p-5 rounded-2xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 animate-fade-in';
                    icon.innerHTML = '<div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600"><i data-lucide="x" class="w-5 h-5"></i></div>';
                    title.textContent = "Cuidado com essa escolha...";
                    title.className = "font-bold text-lg mb-1 text-red-700 dark:text-red-400";
                }
                
                body.textContent = text;
                lucide.createIcons();
                
                // Scroll to feedback on mobile
                setTimeout(() => {
                    area.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }

            nextQuestion() {
                this.state.currentIndex++;
                if (this.state.currentIndex >= journeyData.length) {
                    this.endGame();
                } else {
                    this.renderQuestion();
                }
            }

            endGame() {
                this.dom.gameScreen.classList.add('hidden');
                this.dom.resultScreen.classList.remove('hidden');

                // Stats
                this.dom.finalScore.textContent = this.state.score;
                this.dom.finalStreak.textContent = this.state.streak; // Last streak
                const accuracy = Math.round((this.state.correctCount / journeyData.length) * 100);
                this.dom.finalAccuracy.textContent = `${accuracy}%`;

                // Badge Logic
                let badge = "";
                let msg = "";
                if (accuracy === 100) {
                    badge = "Lenda da Sa√∫de";
                    msg = "Perfeito! Voc√™ sabe exatamente como viver bem.";
                } else if (accuracy >= 80) {
                    badge = "Mestre do Bem-Estar";
                    msg = "√ìtimo desempenho! Pequenos ajustes e voc√™ chega na perfei√ß√£o.";
                } else if (accuracy >= 50) {
                    badge = "Aprendiz Dedicado";
                    msg = "Voc√™ est√° no caminho certo, mas aten√ß√£o aos detalhes!";
                } else {
                    badge = "Iniciante";
                    msg = "Que tal ler nossos artigos para aprender mais sobre sa√∫de?";
                }

                this.dom.finalBadge.textContent = badge;
                this.dom.resultMsg.textContent = msg;
                
                if (accuracy >= 80) {
                    setTimeout(() => {
                        confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                    }, 500);
                }
            }

            reset() {
                this.start();
            }

            share() {
                const accuracy = Math.round((this.state.correctCount / journeyData.length) * 100);
                const text = `Completei a Jornada Saud√°vel com ${accuracy}% de precis√£o e ${this.state.score} pontos! üåÖ‚òÄÔ∏èüåô Voc√™ consegue fazer melhor? Jogue agora:`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Desafio da Rotina Saud√°vel',
                        text: text,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(`${text} ${window.location.href}`);
                    alert('Texto copiado para a √°rea de transfer√™ncia!');
                }
            }
        }

        const game = new RoutineGame();
    </script>
</body>
</html>
